{% load static %}

<link rel="stylesheet" href="{% static 'css/mobile/navbar.css'%}">

<nav class="mynavbar sticky">

    {% if render_mode == 'price_list' %}
    <!-- Go Up -->

    <a class="navbar-brand-" href="#">Наверх</a>
    {% else %}
    <a class="navbar-brand-" href="#"></a>
    {% endif %}
    <!-- row -->

      <!-- Favourite -->
      <a class="btn btn-dark nowrap dropdown-toggle" id="toggle_fav_tab_btn" onclick="toggle_fav_tab();">
        <span>Корзина</span>
        <i class="ml-1 fas fa-shopping-cart"></i>
      </a>

      <!-- Full List -->
      {% if render_mode == 'price_list' %}
      <a class="btn btn-dark nowrap"   onclick="the_searcher.make_query({q:''})">
        <span>Полный список</span>
        <i class="fas fa-list ml-1" style=""></i>
      </a>
      {% elif render_mode == 'single_item' %}
        <a class="btn btn-dark nowrap"  href="/">На Главную</a>
      {% endif %}

      <!-- Contacts -->
      <a class="btn btn-dark"  onclick='toggle_contacts()'><i class="fas fa-phone"></i></a>
    <!-- row -->
      <!-- Dropdown -->
      <div class="dropdown">
        <button class="btn btn-dark dropdown-toggle nowrap max-fill" type="button" id="dropdownMenuButton"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Категории
          <i class="ml-1 fas fa-bars"></i>
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          {% for cat_id, category, count in counted_categories %}
            {% if render_mode == 'price_list' %}
              <a class="dropdown-item noselect" onclick="the_searcher.make_query({cat: '{{cat_id}}'})">{{category}} ({{count}})</a>
            {% elif render_mode == 'single_item' %}
              <a class="dropdown-item noselect" href="/?cat={{cat_id}}">{{category}} ({{count}})</a>
            {% endif %}
          {%endfor%}
        </div>
      </div>


      <!-- Search Form -->

        <div style="position: relative; display: inline-block; ">
          <form id="search_form">
            <input id="search" style="width: 100%" class="form-control nav-wide-cont" type="search" placeholder="Поиск" autocomplete="off" aria-label="Search" value="{{query}}">
          </form>
        </div>

        {% if render_mode == 'price_list' %}
          <script>
            function on_search_evt(e)
            {
                 the_searcher.make_query({q: $('#search').val()});
                 document.activeElement.blur();
                 return false;
            }
            document.getElementById('search_form').onsubmit = e => {return on_search_evt()};
            $('#search').on('input', ()=>
            {
              console.log("inp")
                $.ajax({method: "GET", url: '/api', data: {"pq": $('#search').val()}, success: (r)=>
                    {
                        if (r.success)
                        {
                            console.log(r.payload.sug);
                            autocomplete(r.payload.sug);

                        }
                    }
                })
            });
        </script>
        <button class="btn btn-outline-success my-sm-0" type="button" onclick="on_search_evt()">
          <i class=" fas fa-search"></i>

          </button>
        {% else %}
          <button class="btn btn-outline-success my-sm-0" type="button" onclick="window.location.href = ('/?q=' + $('#search').val() + '#main' )">  <i class=" fas fa-search"></i></button>
          <script>
            document.getElementById('search_form').onsubmit = ()=> {
            window.location.href = ('/?q=' + $('#search').val() )
            document.activeElement.blur();
            return false;
            };
          </script>
        {% endif %}


  </nav>

<script>
const CATS = {{categories|safe}};
const ADMIN = {% if admin %}true;{%else%}false;{%endif%}

/*execute a function presses a key on the keyboard:*/
$('#search').on("keydown", function(e)
{

    var x = document.getElementById("searchautocomplete-list");
    if (x) x = x.getElementsByTagName("div");
    if (e.keyCode == 40) {
      /*If the arrow DOWN key is pressed,
      increase the currentFocus variable:*/
      currentFocus++;
      /*and and make the current item more visible:*/
      addActive(x);
    } else if (e.keyCode == 38) { //up
      /*If the arrow UP key is pressed,
      decrease the currentFocus variable:*/
      currentFocus--;
      /*and and make the current item more visible:*/
      addActive(x);
    } else if (e.keyCode == 13) {
      /*If the ENTER key is pressed, prevent the form from being submitted,*/
      e.preventDefault();
      if (currentFocus > -1) {
        /*and simulate a click on the "active" item:*/
        if (x) x[currentFocus].click();
      }
    }
});
</script>